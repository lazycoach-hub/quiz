<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SAGA Character Sheet — Web‑Native (Draft 1)</title>
  <style>
    :root{
      --ink:#1a1a1a; --muted:#6b7280; --line:#e5e7eb; --bg:#ffffff; --accent:#111;
      --pip-size:20px; --pip-border:2px; --radius:12px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:#f3f4f6;color:var(--ink);font:14px/1.35 system-ui,-apple-system,Segoe UI,Roboto,Inter,Helvetica,Arial,sans-serif}

    .wrap{max-width:1320px;margin:24px auto;padding:0 12px}
    .toolbar{display:flex;gap:10px;justify-content:flex-end;flex-wrap:wrap;margin-bottom:12px}
    .btn{appearance:none;border:1.5px solid var(--ink);background:var(--bg);color:var(--ink);padding:8px 12px;border-radius:10px;cursor:pointer;font-weight:700}

    /* LANDSCAPE SHEET */
    .sheet{background:var(--bg);border:1px solid var(--line);border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.08);padding:16px}
    .grid{display:grid;gap:12px}
    .cols-3{grid-template-columns:1.25fr 1fr 1.25fr}/* desktop landscape feel */

    .section{border:1.5px solid var(--ink);border-radius:var(--radius);padding:12px}
    .title{margin:0 0 8px;font-weight:900;letter-spacing:.1em;text-transform:uppercase;font-size:12px;color:var(--muted)}
    .label{font-size:11px;letter-spacing:.08em;text-transform:uppercase;color:var(--muted);margin-bottom:4px}

    input[type=text],input[type=number],textarea{width:100%;border:1.5px solid var(--ink);border-radius:10px;padding:6px 8px;background:#fff;color:var(--ink)}
    input[type=number]{text-align:center;font-weight:900}
    textarea{min-height:60px;resize:vertical}

    /* portrait */
    .portrait{border:1.5px dashed var(--ink);border-radius:12px;aspect-ratio:3/4;display:grid;place-items:center;background:#fafafa;color:var(--muted)}

    /* pips */
    .pip-row{display:grid;grid-template-columns:auto 52px 1fr;gap:10px;align-items:center}
    .pip-row .name{font-weight:800}
    .pips{display:flex;gap:8px;flex-wrap:wrap}
    .pip{width:var(--pip-size);height:var(--pip-size);border:var(--pip-border) solid var(--accent);border-radius:50%;background:#fff;cursor:pointer}
    .pip.filled{background:var(--accent)}

    /* mastery */
    .mastery-row{display:grid;grid-template-columns:1fr 52px 1fr;gap:8px;align-items:center}
    .mastery-dots{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .ranks{font-size:10px;color:var(--muted);display:flex;gap:12px;margin-left:6px}

    /* items tables */
    table{width:100%;border-collapse:collapse;border:1.5px solid var(--ink);border-radius:12px;overflow:hidden}
    th,td{border-bottom:1px solid var(--line);padding:6px}
    thead th{background:#fafafa;text-transform:uppercase;letter-spacing:.08em;font-size:11px;color:var(--muted)}
    tbody tr:last-child td{border-bottom:none}
    .items td>input[type=text]{width:100%}

    /* layout rows */
    .row{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px}

    @media (max-width:1200px){
      .cols-3{grid-template-columns:1fr}
      .row{grid-template-columns:1fr}
    }

    @media print{
      body{background:#fff}
      .toolbar{display:none}
      .sheet{box-shadow:none;border:1px solid #000}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="toolbar">
      <button class="btn" id="toPdf">Save as PDF</button>
      <button class="btn" id="blank">Blank Sheet</button>
    </div>

    <form id="form">
      <div class="sheet" id="sheet">
        <!-- Top row: Type | Name | Title -->
        <div class="row">
          <div>
            <div class="label">Type</div>
            <input id="type" type="text" />
          </div>
          <div>
            <div class="label">Character Name</div>
            <input id="name" type="text" />
          </div>
          <div>
            <div class="label">Title</div>
            <input id="title" type="text" />
          </div>
        </div>

        <!-- Affinity | Allies -->
        <div class="row">
          <div style="grid-column:1 / span 2">
            <div class="label">Affinity</div>
            <input id="affinity" type="text" />
          </div>
          <div>
            <div class="label">Allies</div>
            <input id="allies" type="text" />
          </div>
        </div>

        <!-- Core tri‑column layout -->
        <div class="grid cols-3">
          <!-- Left column: Natural Powers + Attack -->
          <section class="section">
            <h2 class="title">Natural Powers</h2>
            <div class="grid" style="gap:10px">
              <div class="pip-row" data-pips="10" data-name="Might">
                <div class="name">Might</div>
                <input class="mini" type="number" min="0" max="10" value="0"/>
                <div class="pips" role="group" aria-label="Might" ></div>
              </div>
              <div class="pip-row" data-pips="10" data-name="Finesse">
                <div class="name">Finesse</div>
                <input class="mini" type="number" min="0" max="10" value="0"/>
                <div class="pips" role="group" aria-label="Finesse"></div>
              </div>
              <div class="pip-row" data-pips="10" data-name="Smart">
                <div class="name">Smart</div>
                <input class="mini" type="number" min="0" max="10" value="0"/>
                <div class="pips" role="group" aria-label="Smart"></div>
              </div>
              <div class="pip-row" data-pips="10" data-name="Sneak">
                <div class="name">Sneak</div>
                <input class="mini" type="number" min="0" max="10" value="0"/>
                <div class="pips" role="group" aria-label="Sneak"></div>
              </div>
              <div>
                <div class="label">Life</div>
                <input id="life" type="text" />
              </div>
            </div>

            <h2 class="title" style="margin-top:14px">Attack</h2>
            <div class="pip-row" data-pips="10" data-name="Attack" style="margin-bottom:8px">
              <div class="name">Attack</div>
              <div></div>
              <div class="pips" role="group" aria-label="Attack"></div>
            </div>
            <div class="mastery-row">
              <div><div class="label">Weapon</div><input type="text" placeholder="Weapon name…"/></div>
              <div></div>
              <div>
                <div class="ranks">B Pr Sk Ad Ex El M GM SM A</div>
                <div class="mastery-dots" data-pips="10" data-name="Weapon Mastery"></div>
              </div>
            </div>
            <div class="mastery-row">
              <div><input type="text" placeholder="Weapon name…"/></div>
              <div></div>
              <div>
                <div class="ranks">B Pr Sk Ad Ex El M GM SM A</div>
                <div class="mastery-dots" data-pips="10" data-name="Weapon Mastery"></div>
              </div>
            </div>
          </section>

          <!-- Center column: Portrait + Traits + Fate -->
          <section class="section">
            <h2 class="title">Character Portrait</h2>
            <div class="portrait">Portrait (optional)</div>

            <h2 class="title" style="margin-top:14px">Character Traits</h2>
            <div class="grid" style="gap:10px">
              <div class="pip-row" data-pips="5" data-name="Grit">
                <div class="name">Grit</div>
                <input class="mini" type="number" min="0" max="5" value="0"/>
                <div class="pips" role="group" aria-label="Grit"></div>
              </div>
              <div class="pip-row" data-pips="5" data-name="Guts">
                <div class="name">Guts</div>
                <input class="mini" type="number" min="0" max="5" value="0"/>
                <div class="pips" role="group" aria-label="Guts"></div>
              </div>
              <div class="pip-row" data-pips="5" data-name="Heart">
                <div class="name">Heart</div>
                <input class="mini" type="number" min="0" max="5" value="0"/>
                <div class="pips" role="group" aria-label="Heart"></div>
              </div>
              <div class="pip-row" data-pips="5" data-name="Flair">
                <div class="name">Flair</div>
                <input class="mini" type="number" min="0" max="5" value="0"/>
                <div class="pips" role="group" aria-label="Flair"></div>
              </div>
              <div class="pip-row" data-pips="5" data-name="Focus">
                <div class="name">Focus</div>
                <input class="mini" type="number" min="0" max="5" value="0"/>
                <div class="pips" role="group" aria-label="Focus"></div>
              </div>
            </div>

            <h2 class="title" style="margin-top:14px">Fate</h2>
            <div class="row">
              <div>
                <div class="label">Destiny</div>
                <input type="number" min="0" max="99" value="0" />
              </div>
              <div>
                <div class="label">Fate</div>
                <input type="number" min="0" max="99" value="0" />
              </div>
              <div>
                <div class="label">Despair</div>
                <input type="number" min="0" max="99" value="0" />
              </div>
            </div>
          </section>

          <!-- Right column: Fantasy Powers + Defend -->
          <section class="section">
            <h2 class="title">Fantasy Powers</h2>
            <div class="grid" style="gap:10px">
              <div class="pip-row" data-pips="10" data-name="Faith">
                <div class="name">Faith</div>
                <input class="mini" type="number" min="0" max="10" value="0"/>
                <div class="pips" role="group" aria-label="Faith"></div>
              </div>
              <div class="pip-row" data-pips="10" data-name="Magic">
                <div class="name">Magic</div>
                <input class="mini" type="number" min="0" max="10" value="0"/>
                <div class="pips" role="group" aria-label="Magic"></div>
              </div>
              <div class="pip-row" data-pips="10" data-name="Mystic">
                <div class="name">Mystic</div>
                <input class="mini" type="number" min="0" max="10" value="0"/>
                <div class="pips" role="group" aria-label="Mystic"></div>
              </div>
              <div class="pip-row" data-pips="10" data-name="Spirit">
                <div class="name">Spirit</div>
                <input class="mini" type="number" min="0" max="10" value="0"/>
                <div class="pips" role="group" aria-label="Spirit"></div>
              </div>
              <div>
                <div class="label">Death</div>
                <input id="death" type="text" />
              </div>
            </div>

            <h2 class="title" style="margin-top:14px">Defend</h2>
            <div class="pip-row" data-pips="10" data-name="Defend" style="margin-bottom:8px">
              <div class="name">Defend</div>
              <div></div>
              <div class="pips" role="group" aria-label="Defend"></div>
            </div>
            <div class="mastery-row">
              <div><div class="label">Armor / Protection</div><input type="text" placeholder="Armor / protection…"/></div>
              <div></div>
              <div>
                <div class="ranks">B Pr Sk Ad Ex El M GM SM A</div>
                <div class="mastery-dots" data-pips="10" data-name="Armor Mastery"></div>
              </div>
            </div>
            <div class="mastery-row">
              <div><input type="text" placeholder="Armor / protection…"/></div>
              <div></div>
              <div>
                <div class="ranks">B Pr Sk Ad Ex El M GM SM A</div>
                <div class="mastery-dots" data-pips="10" data-name="Armor Mastery"></div>
              </div>
            </div>
          </section>
        </div>

        <!-- Bottom: Non‑Magic Items (2/3 width) | Magic Items (1/3 width) -->
        <div class="grid" style="grid-template-columns:2fr 1fr; gap:12px; margin-top:12px">
          <section class="section">
            <h2 class="title">Non‑Magic Items</h2>
            <table class="items" id="nmTbl">
              <thead>
                <tr><th>Item</th><th>Item</th><th>Item</th><th>Item</th></tr>
              </thead>
              <tbody></tbody>
            </table>
            <div style="margin-top:6px;display:flex;gap:8px"><button type="button" class="btn" id="nmAddRow">Add row</button><button type="button" class="btn" id="nmDelRow">Delete last row</button></div>
          </section>
          <section class="section">
            <h2 class="title">Magic Items</h2>
            <div class="grid" id="magicList" style="gap:8px"></div>
            <div style="margin-top:6px;display:flex;gap:8px"><button type="button" class="btn" id="mAdd">Add magic item</button><button type="button" class="btn" id="mDel">Delete last</button></div>
          </section>
        </div>

      </div>
    </form>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/html2pdf.js@0.10.1/dist/html2pdf.bundle.min.js"></script>
  <script>
    // Build pips for every row
    function buildPipRow(row){
      const pips = row.querySelector('.pips') || row;
      const count = parseInt(row.getAttribute('data-pips')||'10',10);
      pips.innerHTML='';
      for(let i=0;i<count;i++){
        const b=document.createElement('button');
        b.type='button'; b.className='pip'; b.dataset.index=i;
        b.addEventListener('click',()=>{
          const current=parseInt(row.dataset.value||'0',10);
          const next=(i+1===current)?0:(i+1);
          row.dataset.value=String(next);
          updatePips(row);
          const mini=row.querySelector('input.mini');
          if(mini){mini.value=next}
        });
        pips.appendChild(b);
      }
      pips.addEventListener('keydown',(e)=>{
        const current=parseInt(row.dataset.value||'0',10);
        if(e.key==='ArrowRight' || e.key==='+'){row.dataset.value=Math.min(current+1,count); updatePips(row); e.preventDefault();}
        if(e.key==='ArrowLeft' || e.key==='-'){row.dataset.value=Math.max(current-1,0); updatePips(row); e.preventDefault();}
      });
      updatePips(row);
    }
    function updatePips(row){
      const val=parseInt(row.dataset.value||'0',10);
      row.querySelectorAll('.pip').forEach((pip,i)=>pip.classList.toggle('filled',i<val));
    }
    document.querySelectorAll('.pip-row').forEach(buildPipRow);
    document.querySelectorAll('.mastery-dots').forEach(el=>{el.setAttribute('data-pips','10'); buildPipRow(el.parentElement)});

    // Sync small number boxes for trait/power rows
    document.querySelectorAll('.pip-row input.mini').forEach(mini=>{
      const row=mini.closest('.pip-row');
      const max=parseInt(row.getAttribute('data-pips')||'10',10);
      mini.addEventListener('input',()=>{
        const v=Math.max(0,Math.min(max, parseInt(mini.value||'0',10)));
        row.dataset.value=String(v); updatePips(row);
      });
    });

    // Non‑magic items grid (default 5 rows)
    const nmBody=document.querySelector('#nmTbl tbody');
    function addNmRow(){
      const tr=document.createElement('tr');
      for(let i=0;i<4;i++){const td=document.createElement('td'); const inp=document.createElement('input'); inp.type='text'; td.appendChild(inp); tr.appendChild(td)}
      nmBody.appendChild(tr);
    }
    for(let i=0;i<5;i++) addNmRow();
    document.getElementById('nmAddRow').onclick=addNmRow;
    document.getElementById('nmDelRow').onclick=()=>{if(nmBody.lastElementChild) nmBody.removeChild(nmBody.lastElementChild)};

    // Magic items list with enchantment pips (5 defaults)
    const magicList=document.getElementById('magicList');
    function addMagicItem(){
      const row=document.createElement('div');
      row.className='pip-row'; row.setAttribute('data-pips','5'); row.dataset.value='0';
      row.innerHTML='<div class="name">Magic Item</div><div></div><div class="pips" role="group" aria-label="Enchantment level"></div>';
      const itemInput=document.createElement('input'); itemInput.type='text'; itemInput.placeholder='Item description…';
      row.firstElementChild.replaceWith(itemInput);
      magicList.appendChild(row); buildPipRow(row);
    }
    for(let i=0;i<5;i++) addMagicItem();
    document.getElementById('mAdd').onclick=addMagicItem;
    document.getElementById('mDel').onclick=()=>{if(magicList.lastElementChild) magicList.removeChild(magicList.lastElementChild)};

    // PDF export
    document.getElementById('toPdf').addEventListener('click',()=>{
      const name=(document.getElementById('name').value||'saga-character').replace(/[^a-z0-9\-_]+/gi,'_');
      const opt={margin:[6,6,6,6], filename:name+'.pdf', image:{type:'jpeg',quality:0.95}, html2canvas:{scale:2,useCORS:true}, jsPDF:{unit:'mm',format:'a4',orientation:'landscape'}};
      html2pdf().set(opt).from(document.getElementById('sheet')).save();
    });

    // Blank sheet / reset
    document.getElementById('blank').addEventListener('click',()=>{
      document.getElementById('form').reset();
      document.querySelectorAll('.pip-row').forEach(r=>{r.dataset.value='0'; updatePips(r)});
      // re-add default rows if user deleted
      while(nmBody.children.length<5) addNmRow();
      while(magicList.children.length<5) addMagicItem();
      window.scrollTo({top:0,behavior:'smooth'});
    });
  </script>
</body>
</html>
