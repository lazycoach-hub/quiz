<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Sales Attachment Style Quiz</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      max-width: 700px;
      margin: 0 auto;
      line-height: 1.6;
    }
    h1, h2 {
      text-align: center;
    }
    .question {
      margin-bottom: 20px;
    }
    .result {
      margin-top: 30px;
      padding: 15px;
      border: 1px solid #ccc;
      background-color: #f9f9f9;
    }
    .optin-section {
      margin-top: 50px;
      text-align: center;
    }
  </style>
</head>
<body>
  <h1>Sales Attachment Style Quiz</h1>

  <form id="quiz-form">
    <div class="question">
      <p>1. I enjoy sharing my work with others, even if it doesn't lead to a sale.</p>
      <label><input type="radio" name="q1" value="adaptive"> Strongly Agree</label><br/>
      <label><input type="radio" name="q1" value="independent"> Strongly Disagree</label><br/>
      <label><input type="radio" name="q1" value="righteous"> Agree</label><br/>
      <label><input type="radio" name="q1" value="desirable"> Neutral</label>
    </div>
    <!-- Add more questions like above here -->
    <button type="submit">Get My Style</button>
  </form>

  <div id="result" class="result" style="display: none;"></div>

  <div id="optin-section" class="optin-section" style="display: none;">
    <h2>Enter your details below to get the full breakdown and understand your results</h2>

    <!-- BEGIN KARTRA FORM -->
    <div class="kartra_optin_container">
      <div id="K-FRM_IDbJDnEsY" class="kartra_optin_position_left K-FRM_IDbJDnEsY"></div>
      <script src="https://app.kartra.com/resources/js/form.embed.js"></script>
      <script>
        window.onload = function () {
          const resultDiv = document.getElementById('result');
          const adaptive = document.createElement('input');
          const independent = document.createElement('input');
          const righteous = document.createElement('input');
          const desirable = document.createElement('input');

          [adaptive, independent, righteous, desirable].forEach(input => {
            input.type = 'hidden';
            input.name = '';
            input.className = 'custom_field'; // Required by Kartra
          });

          adaptive.name = 'adaptiveScore';
          independent.name = 'independentScore';
          righteous.name = 'righteousScore';
          desirable.name = 'desirableScore';

          const observer = new MutationObserver(() => {
            const form = document.querySelector('.kartra_optin_position_left form');
            if (form && !form.querySelector('[name="adaptiveScore"]')) {
              form.appendChild(adaptive);
              form.appendChild(independent);
              form.appendChild(righteous);
              form.appendChild(desirable);
            }
          });

          observer.observe(document.body, { childList: true, subtree: true });

          window.populateHiddenFields = function (scores) {
            adaptive.value = scores.adaptive;
            independent.value = scores.independent;
            righteous.value = scores.righteous;
            desirable.value = scores.desirable;
          };
        };
      </script>
    </div>
    <!-- END KARTRA FORM -->

  </div>

  <script>
    document.getElementById("quiz-form").addEventListener("submit", function(e) {
      e.preventDefault();

      const answers = document.querySelectorAll("input[type=radio]:checked");
      const counts = {
        adaptive: 0,
        independent: 0,
        righteous: 0,
        desirable: 0,
      };

      answers.forEach(ans => {
        if (counts[ans.value] !== undefined) {
          counts[ans.value]++;
        }
      });

      const total = Object.values(counts).reduce((a, b) => a + b, 0);
      const ratios = {
        adaptive: ((counts.adaptive / total) * 100).toFixed(1),
        independent: ((counts.independent / total) * 100).toFixed(1),
        righteous: ((counts.righteous / total) * 100).toFixed(1),
        desirable: ((counts.desirable / total) * 100).toFixed(1)
      };

      const resultDiv = document.getElementById("result");
      resultDiv.innerHTML = `
        <h2>Your Sales Attachment Style Breakdown</h2>
        <p><strong>Adaptive:</strong> ${ratios.adaptive}%</p>
        <p><strong>Independent:</strong> ${ratios.independent}%</p>
        <p><strong>Righteous:</strong> ${ratios.righteous}%</p>
        <p><strong>Desirable:</strong> ${ratios.desirable}%</p>
      `;
      resultDiv.style.display = "block";

      document.getElementById("optin-section").style.display = "block";

      // Populate hidden fields for Kartra form
      if (typeof window.populateHiddenFields === "function") {
        window.populateHiddenFields(ratios);
      }
    });
  </script>
</body>
</html>
