<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SAGA Character Sheet â€” Exact Overlay</title>
<style>
:root{--ink:#111;--muted:#6b7280}
html,body{margin:0;background:#222;color:#111;font:14px/1.35 Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
.toolbar{display:flex;gap:8px;justify-content:center;align-items:center;padding:10px}
.toolbar .btn{appearance:none;border:1.5px solid #111;background:#fff;color:#111;padding:8px 12px;border-radius:8px;font-weight:700;cursor:pointer}
.stage{display:flex;justify-content:center;padding:10px 0 30px}


/* === SHEET BACKDROP (exact pixel size to match PNG) === */
.sheet{position:relative;width:1186px;height:768px;background:url('saga_character_sheet.png') no-repeat 0 0/100% 100%;box-shadow:0 10px 35px rgba(0,0,0,.35);}


/* === GENERIC FIELD STYLES === */
.field{position:absolute}
input[type=text], input[type=number], textarea{border:1.5px solid #333;border-radius:6px;padding:4px 6px;background:#fff;color:#111;font:14px/1.2 Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
input[type=number]{text-align:center}
textarea{resize:none}


/* Pips */
.pip-row{position:absolute;display:flex;gap:8px;align-items:center}
.pip{width:18px;height:18px;border:2px solid #000;border-radius:50%;background:#fff;cursor:pointer;display:inline-block}
.pip.filled{background:#000}


/* Mastery row (10 pips with initials) */
.mastery{position:absolute}
.mastery .labels{position:absolute;display:flex;gap:14px;left:0;top:-16px;font-size:10px;color:#111}
.mastery .dots{display:flex;gap:8px}


/* Items grid */
.item{position:absolute}


/* Edit/drag aid (toggleable) */
.draggable{outline:1px dashed transparent}
.drag-on .draggable{outline:1px dashed #06c}
</style>
</head>
<body>
<div class="toolbar">
<button class="btn" id="savePdf">Save as PDF</button>
<button class="btn" id="blank">Blank Sheet</button>
<button class="btn" id="toggleEdit" title="Hold Shift to drag when ON">Edit Mode</button>
</div>
<div class="stage">
<div class="sheet" id="sheet"></div>
</div>


<!-- html2pdf for export -->
<script src="https://cdn.jsdelivr.net/npm/html2pdf.js@0.10.1/dist/html2pdf.bundle.min.js"></script>
<script>
/**
* Exact overlay engine
* All positions are in pixels relative to sheet (1186x768)
* You can tweak in Edit Mode (Shift+drag) and positions persist in localStorage.
*/
const SHEET_W=1186, SHEET_H=768;
const sheet = document.getElementById('sheet');


// Utility builders
function addText(id,x,y,w,h,placeholder=''){const el=document.createElement('input');el.type='text';el.id=id;el.className='field draggable';style(el,x,y,w,h);el.placeholder=placeholder;sheet.appendChild(el);return el}
function addArea(id,x,y,w,h){const el=document.createElement('textarea');el.id=id;el.className='field draggable';style(el,x,y,w,h);sheet.appendChild(el);return el}
function addNumber(id,x,y,w,h){const el=document.createElement('input');el.type='number';el.id=id;el.className='field draggable';style(el,x,y,w,h);sheet.appendChild(el);return el}
function addPortraitBox(id,x,y,w,h){const el=document.createElement('div');el.id=id;el.className='field draggable';style(el,x,y,w,h);el.style.border='1px solid transparent';sheet.appendChild(el);return el}
function addPips(id,x,y,count,spacing=22){const wrap=document.createElement('div');wrap.id=id;wrap.className='pip-row draggable';wrap.style.left=x+'px';wrap.style.top=y+'px';sheet.appendChild(wrap);for(let i=0;i<count;i++){const b=document.createElement('div');b.className='pip';b.dataset.index=i;wrap.appendChild(b)}wrap.addEventListener('click',e=>{const t=e.target;if(!t.classList.contains('pip'))return;const idx=parseInt(t.dataset.index,10);const v=parseInt(wrap.dataset.value||0,10);const next=(idx+1===v)?0:idx+1;wrap.dataset.value=next;updatePips(wrap)});updatePips(wrap);return wrap}
function updatePips(wrap){const v=parseInt(wrap.dataset.value||0,10);[...wrap.children].forEach((p,i)=>p.classList.toggle('filled',i<v))}
function addMastery(id,x,y){const mc=document.createElement('div');mc.id=id;mc.className='mastery draggable';mc.style.left=x+'px';mc.style.top=y+'px';const labels=document.createElement('div');labels.className='labels';const abbrev=['B','Pr','Sk','Ad','Ex','El','M','GM','SM','A'];abbrev.forEach(a=>{const s=document.createElement('span');s.textContent=a;labels.appendChild(s)});const dots=document.createElement('div');dots.className='dots';for(let i=0;i<10;i++){const d=document.createElement('div');d.className='pip';d.dataset.index=i;dots.appendChild(d)}mc.appendChild(labels);mc.appendChild(dots);dots.addEventListener('click',e=>{const t=e.target;if(!t.classList.contains('pip'))return;const idx=parseInt(t.dataset.index,10);const v=parseInt(mc.dataset.value||-1,10);mc.dataset.value=(v===idx)?-1:idx;updateMastery(mc)});updateMastery(mc);sheet.appendChild(mc);return mc}
function updateMastery(mc){const sel=parseInt(mc.dataset.value||-1,10);const dots=mc.querySelectorAll('.pip');dots.forEach((d,i)=>d.classList.toggle('filled', sel>=0 && i<=sel))}
function style(el,x,y,w,h){el.style.left=x+'px';el.style.top=y+'px';if(w)el.style.width=w+'px';if(h)el.style.height=h+'px'}


// === LAYOUT MAP (initial coordinates approximated to provided PNG).
